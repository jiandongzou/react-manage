import{a as Lt,K as re,y as It,w as Re,B as lt}from"./rc-util-8ac52126.js";import{c as W,h as j,e as ct,b as dt,a as _,d as Kt,_ as Tt}from"./@babel-9367d27f.js";import{r}from"./react-16261f20.js";import{u as _t,b as Vt,B as Nt}from"./rc-select-d03dfa8d.js";import{T as Mt,c as Pt,d as Je}from"./rc-tree-6e351d8e.js";import"./classnames-f3eb6505.js";import"./react-is-e8e5dbb3.js";var st=r.createContext(null),ft=r.createContext(null);function At(e){return Array.isArray(e)?e:e!==void 0?[e]:[]}function Ht(e){var t=e||{},n=t.label,o=t.value,l=t.children,u=o||"value";return{_title:n?[n]:["title","label"],value:u,key:u,children:l||"children"}}function Ye(e){return!e||e.disabled||e.disableCheckbox||e.checkable===!1}function Ot(e,t){var n=[];function o(l){l.forEach(function(u){var a=u[t.children];a&&(n.push(u[t.value]),o(a))})}return o(e),n}function it(e){return e==null}var $t={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},Rt=function(t,n){var o=_t(),l=o.prefixCls,u=o.multiple,a=o.searchValue,c=o.toggleOpen,i=o.open,s=o.notFoundContent,v=r.useContext(ft),D=v.virtual,S=v.listHeight,E=v.listItemHeight,L=v.treeData,I=v.fieldNames,B=v.onSelect,O=v.dropdownMatchSelectWidth,U=v.treeExpandAction,g=r.useContext(st),K=g.checkable,V=g.checkedKeys,ne=g.halfCheckedKeys,H=g.treeExpandedKeys,We=g.treeDefaultExpandAll,me=g.treeDefaultExpandedKeys,ye=g.onTreeExpand,je=g.treeIcon,Be=g.showTreeIcon,Ce=g.switcherIcon,Se=g.treeLine,be=g.treeNodeFilterProp,Ee=g.loadData,ae=g.treeLoadedKeys,ke=g.treeMotion,xe=g.onTreeLoad,we=g.keyEntities,G=r.useRef(),le=Lt(function(){return L},[i,L],function(h,k){return k[0]&&h[1]!==k[1]}),De=r.useMemo(function(){return K?{checked:V,halfChecked:ne}:null},[K,V,ne]);r.useEffect(function(){if(i&&!u&&V.length){var h;(h=G.current)===null||h===void 0||h.scrollTo({key:V[0]})}},[i]);var ie=String(a).toLowerCase(),Le=function(k){return ie?String(k[be]).toLowerCase().includes(ie):!1},oe=r.useState(me),ue=W(oe,2),Q=ue[0],Ie=ue[1],Ke=r.useState(null),ce=W(Ke,2),de=ce[0],se=ce[1],Te=r.useMemo(function(){return H?j(H):a?de:Q},[Q,de,H,a]);r.useEffect(function(){a&&se(Ot(L,I))},[a]);var Ue=function(k){Ie(k),se(k),ye&&ye(k)},J=function(k){k.preventDefault()},$=function(k,Y){var P=Y.node;K&&Ye(P)||(B(P.key,{selected:!V.includes(P.key)}),u||c(!1))},_e=r.useState(null),M=W(_e,2),fe=M[0],Ve=M[1],N=we[fe];if(r.useImperativeHandle(n,function(){var h;return{scrollTo:(h=G.current)===null||h===void 0?void 0:h.scrollTo,onKeyDown:function(Y){var P,Ne=Y.which;switch(Ne){case re.UP:case re.DOWN:case re.LEFT:case re.RIGHT:(P=G.current)===null||P===void 0||P.onKeyDown(Y);break;case re.ENTER:{if(N){var Me=(N==null?void 0:N.node)||{},X=Me.selectable,Pe=Me.value;X!==!1&&$(null,{node:{key:fe},selected:!V.includes(Pe)})}break}case re.ESC:c(!1)}},onKeyUp:function(){}}}),le.length===0)return r.createElement("div",{role:"listbox",className:"".concat(l,"-empty"),onMouseDown:J},s);var ve={fieldNames:I};return ae&&(ve.loadedKeys=ae),Te&&(ve.expandedKeys=Te),r.createElement("div",{onMouseDown:J},N&&i&&r.createElement("span",{style:$t,"aria-live":"assertive"},N.node.value),r.createElement(Mt,ct({ref:G,focusable:!1,prefixCls:"".concat(l,"-tree"),treeData:le,height:S,itemHeight:E,virtual:D!==!1&&O!==!1,multiple:u,icon:je,showIcon:Be,switcherIcon:Ce,showLine:Se,loadData:a?null:Ee,motion:ke,activeKey:fe,checkable:K,checkStrictly:!0,checkedKeys:De,selectedKeys:K?[]:V,defaultExpandAll:We},ve,{onActiveChange:Ve,onSelect:$,onCheck:$,onExpand:Ue,onLoad:xe,filterTreeNode:Le,expandAction:U})))},vt=r.forwardRef(Rt);vt.displayName="OptionList";var ht=function(){return null},Ft="SHOW_ALL",pt="SHOW_PARENT",ze="SHOW_CHILD";function ot(e,t,n,o){var l=new Set(e);return t===ze?e.filter(function(u){var a=n[u];return!(a&&a.children&&a.children.some(function(c){var i=c.node;return l.has(i[o.value])})&&a.children.every(function(c){var i=c.node;return Ye(i)||l.has(i[o.value])}))}):t===pt?e.filter(function(u){var a=n[u],c=a?a.parent:null;return!(c&&!Ye(c.node)&&l.has(c.key))}):e}var Wt=["children","value"];function gt(e){return It(e).map(function(t){if(!r.isValidElement(t)||!t.type)return null;var n=t,o=n.key,l=n.props,u=l.children,a=l.value,c=dt(l,Wt),i=_({key:o,value:a},c),s=gt(u);return s.length&&(i.children=s),i}).filter(function(t){return t})}function qe(e){if(!e)return e;var t=_({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return Re(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function jt(e,t,n,o,l,u){var a=null,c=null;function i(){function s(v){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v.map(function(E,L){var I="".concat(D,"-").concat(L),B=E[u.value],O=n.includes(B),U=s(E[u.children]||[],I,O),g=r.createElement(ht,E,U.map(function(V){return V.node}));if(t===B&&(a=g),O){var K={pos:I,node:g,children:U};return S||c.push(K),K}return null}).filter(function(E){return E})}c||(c=[],s(o),c.sort(function(v,D){var S=v.node.props.value,E=D.node.props.value,L=n.indexOf(S),I=n.indexOf(E);return L-I}))}Object.defineProperty(e,"triggerNode",{get:function(){return Re(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),i(),a}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return Re(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),i(),l?c:c.map(function(v){var D=v.node;return D})}})}function Bt(e,t){var n=t.id,o=t.pId,l=t.rootPId,u={},a=[],c=e.map(function(i){var s=_({},i),v=s[n];return u[v]=s,s.key=s.key||v,s});return c.forEach(function(i){var s=i[o],v=u[s];v&&(v.children=v.children||[],v.children.push(i)),(s===l||!v&&l===null)&&a.push(i)}),a}function Ut(e,t,n){return r.useMemo(function(){return e?n?Bt(e,_({id:"id",pId:"pId",rootPId:null},n!==!0?n:{})):e:gt(t)},[t,n,e])}const Gt=function(e){var t=r.useRef({valueLabels:new Map});return r.useMemo(function(){var n=t.current.valueLabels,o=new Map,l=e.map(function(u){var a,c=u.value,i=(a=u.label)!==null&&a!==void 0?a:n.get(c);return o.set(c,i),_(_({},u),{},{label:i})});return t.current.valueLabels=o,[l]},[e])};function ut(e){var t=r.useRef();t.current=e;var n=r.useCallback(function(){return t.current.apply(t,arguments)},[]);return n}const Jt=function(e,t){return r.useMemo(function(){var n=Pt(e,{fieldNames:t,initWrapper:function(l){return _(_({},l),{},{valueEntities:new Map})},processEntity:function(l,u){var a=l.node[t.value];u.valueEntities.set(a,l)}});return n},[e,t])},Yt=function(e,t,n,o){return r.useMemo(function(){var l=e.map(function(i){var s=i.value;return s}),u=t.map(function(i){var s=i.value;return s}),a=l.filter(function(i){return!o[i]});if(n){var c=Je(l,!0,o);l=c.checkedKeys,u=c.halfCheckedKeys}return[Array.from(new Set([].concat(j(a),j(l)))),u]},[e,t,n,o])},qt=function(e,t,n){var o=n.treeNodeFilterProp,l=n.filterTreeNode,u=n.fieldNames,a=u.children;return r.useMemo(function(){if(!t||l===!1)return e;var c;if(typeof l=="function")c=l;else{var i=t.toUpperCase();c=function(D,S){var E=S[o];return String(E).toUpperCase().includes(i)}}function s(v){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return v.map(function(S){var E=S[a],L=D||c(t,qe(S)),I=s(E||[],L);return L||I.length?_(_({},S),{},Kt({isLeaf:void 0},a,I)):null}).filter(function(S){return S})}return s(e)},[e,t,a,o,l])};var zt=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion"];function Qt(e){return!e||Tt(e)!=="object"}var Xt=r.forwardRef(function(e,t){var n=e.id,o=e.prefixCls,l=o===void 0?"rc-tree-select":o,u=e.value,a=e.defaultValue,c=e.onChange,i=e.onSelect,s=e.onDeselect,v=e.searchValue,D=e.inputValue,S=e.onSearch,E=e.autoClearSearchValue,L=E===void 0?!0:E,I=e.filterTreeNode,B=e.treeNodeFilterProp,O=B===void 0?"value":B,U=e.showCheckedStrategy,g=U===void 0?ze:U,K=e.treeNodeLabelProp,V=e.multiple,ne=e.treeCheckable,H=e.treeCheckStrictly,We=e.labelInValue,me=e.fieldNames,ye=e.treeDataSimpleMode,je=e.treeData,Be=e.children,Ce=e.loadData,Se=e.treeLoadedKeys,be=e.onTreeLoad,Ee=e.treeDefaultExpandAll,ae=e.treeExpandedKeys,ke=e.treeDefaultExpandedKeys,xe=e.onTreeExpand,we=e.treeExpandAction,G=e.virtual,le=e.listHeight,De=le===void 0?200:le,ie=e.listItemHeight,Le=ie===void 0?20:ie,oe=e.onDropdownVisibleChange,ue=e.dropdownMatchSelectWidth,Q=ue===void 0?!0:ue,Ie=e.treeLine,Ke=e.treeIcon,ce=e.showTreeIcon,de=e.switcherIcon,se=e.treeMotion,Te=dt(e,zt),Ue=Vt(n),J=ne&&!H,$=ne||H,_e=H||We,M=$||V,fe=lt(a,{value:u}),Ve=W(fe,2),N=Ve[0],ve=Ve[1],h=r.useMemo(function(){return Ht(me)},[JSON.stringify(me)]),k=lt("",{value:v!==void 0?v:D,postState:function(d){return d||""}}),Y=W(k,2),P=Y[0],Ne=Y[1],Me=function(d){Ne(d),S==null||S(d)},X=Ut(je,Be,ye),Pe=Jt(X,h),T=Pe.keyEntities,q=Pe.valueEntities,Qe=r.useCallback(function(f){var d=[],p=[];return f.forEach(function(m){q.has(m)?p.push(m):d.push(m)}),{missingRawValues:d,existRawValues:p}},[q]),Xe=qt(X,P,{fieldNames:h,treeNodeFilterProp:O,filterTreeNode:I}),Ze=r.useCallback(function(f){if(f){if(K)return f[K];for(var d=h._title,p=0;p<d.length;p+=1){var m=f[d[p]];if(m!==void 0)return m}}},[h,K]),he=r.useCallback(function(f){var d=At(f);return d.map(function(p){return Qt(p)?{value:p}:p})},[]),Ae=r.useCallback(function(f){var d=he(f);return d.map(function(p){var m=p.label,w=p.value,b=p.halfChecked,y,C=q.get(w);if(C){var x;m=(x=m)!==null&&x!==void 0?x:Ze(C.node),y=C.node.disabled}else if(m===void 0){var R=he(N).find(function(pe){return pe.value===w});m=R.label}return{label:m,value:w,halfChecked:b,disabled:y}})},[q,Ze,he,N]),et=r.useMemo(function(){return he(N)},[he,N]),mt=r.useMemo(function(){var f=[],d=[];return et.forEach(function(p){p.halfChecked?d.push(p):f.push(p)}),[f,d]},[et]),tt=W(mt,2),Z=tt[0],rt=tt[1],nt=r.useMemo(function(){return Z.map(function(f){return f.value})},[Z]),yt=Yt(Z,rt,J,T),at=W(yt,2),ee=at[0],He=at[1],Ct=r.useMemo(function(){var f=ot(ee,g,T,h),d=f.map(function(b){var y,C,x;return(y=(C=T[b])===null||C===void 0||(x=C.node)===null||x===void 0?void 0:x[h.value])!==null&&y!==void 0?y:b}),p=d.map(function(b){var y=Z.find(function(C){return C.value===b});return{value:b,label:y==null?void 0:y.label}}),m=Ae(p),w=m[0];return!M&&w&&it(w.value)&&it(w.label)?[]:m.map(function(b){var y;return _(_({},b),{},{label:(y=b.label)!==null&&y!==void 0?y:b.value})})},[h,M,ee,Z,Ae,g,T]),St=Gt(Ct),bt=W(St,1),Et=bt[0],Oe=ut(function(f,d,p){var m=Ae(f);if(ve(m),L&&Ne(""),c){var w=f;if(J){var b=ot(f,g,T,h);w=b.map(function(A){var F=q.get(A);return F?F.node[h.value]:A})}var y=d||{triggerValue:void 0,selected:void 0},C=y.triggerValue,x=y.selected,R=w;if(H){var pe=rt.filter(function(A){return!w.includes(A.value)});R=[].concat(j(R),j(pe))}var ge=Ae(R),z={preValue:Z,triggerValue:C},te=!0;(H||p==="selection"&&!x)&&(te=!1),jt(z,C,f,X,te,h),$?z.checked=x:z.selected=x;var $e=_e?ge:ge.map(function(A){return A.value});c(M?$e:$e[0],_e?null:ge.map(function(A){return A.label}),z)}}),Ge=r.useCallback(function(f,d){var p,m=d.selected,w=d.source,b=T[f],y=b==null?void 0:b.node,C=(p=y==null?void 0:y[h.value])!==null&&p!==void 0?p:f;if(!M)Oe([C],{selected:!0,triggerValue:C},"option");else{var x=m?[].concat(j(nt),[C]):ee.filter(function(F){return F!==C});if(J){var R=Qe(x),pe=R.missingRawValues,ge=R.existRawValues,z=ge.map(function(F){return q.get(F).key}),te;if(m){var $e=Je(z,!0,T);te=$e.checkedKeys}else{var A=Je(z,{checked:!1,halfCheckedKeys:He},T);te=A.checkedKeys}x=[].concat(j(pe),j(te.map(function(F){return T[F].node[h.value]})))}Oe(x,{selected:m,triggerValue:C},w||"option")}m||!M?i==null||i(C,qe(y)):s==null||s(C,qe(y))},[Qe,q,T,h,M,nt,Oe,J,i,s,ee,He]),kt=r.useCallback(function(f){if(oe){var d={};Object.defineProperty(d,"documentClickClose",{get:function(){return Re(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),oe(f,d)}},[oe]),xt=ut(function(f,d){var p=f.map(function(m){return m.value});if(d.type==="clear"){Oe(p,{},"selection");return}d.values.length&&Ge(d.values[0].value,{selected:!1,source:"selection"})}),wt=r.useMemo(function(){return{virtual:G,dropdownMatchSelectWidth:Q,listHeight:De,listItemHeight:Le,treeData:Xe,fieldNames:h,onSelect:Ge,treeExpandAction:we}},[G,Q,De,Le,Xe,h,Ge,we]),Dt=r.useMemo(function(){return{checkable:$,loadData:Ce,treeLoadedKeys:Se,onTreeLoad:be,checkedKeys:ee,halfCheckedKeys:He,treeDefaultExpandAll:Ee,treeExpandedKeys:ae,treeDefaultExpandedKeys:ke,onTreeExpand:xe,treeIcon:Ke,treeMotion:se,showTreeIcon:ce,switcherIcon:de,treeLine:Ie,treeNodeFilterProp:O,keyEntities:T}},[$,Ce,Se,be,ee,He,Ee,ae,ke,xe,Ke,se,ce,de,Ie,O,T]);return r.createElement(ft.Provider,{value:wt},r.createElement(st.Provider,{value:Dt},r.createElement(Nt,ct({ref:t},Te,{id:Ue,prefixCls:l,mode:M?"multiple":void 0,displayValues:Et,onDisplayValuesChange:xt,searchValue:P,onSearch:Me,OptionList:vt,emptyOptions:!X.length,onDropdownVisibleChange:kt,dropdownMatchSelectWidth:Q}))))}),Fe=Xt;Fe.TreeNode=ht;Fe.SHOW_ALL=Ft;Fe.SHOW_PARENT=pt;Fe.SHOW_CHILD=ze;export{Fe as G,Ft as S,ht as T,pt as a,ze as b};
