import{b as pe,c as T,_ as he,a as $,e as Se,d as de,h as q}from"./@babel-9367d27f.js";import{c as ce}from"./classnames-f3eb6505.js";import{B as Ne,r as oe,f as _e}from"./rc-input-7d7eb8fa.js";import{B as xe,d as ve,l as ge}from"./rc-util-8ac52126.js";import{r as v,R}from"./react-16261f20.js";import{R as Pe}from"./rc-resize-observer-f56315fc.js";var Fe=`
  min-height:0 !important;
  max-height:none !important;
  height:0 !important;
  visibility:hidden !important;
  overflow:hidden !important;
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
  pointer-events: none !important;
`,Me=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing","word-break","white-space"],ie={},h;function $e(e){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=e.getAttribute("id")||e.getAttribute("data-reactid")||e.getAttribute("name");if(c&&ie[a])return ie[a];var r=window.getComputedStyle(e),l=r.getPropertyValue("box-sizing")||r.getPropertyValue("-moz-box-sizing")||r.getPropertyValue("-webkit-box-sizing"),f=parseFloat(r.getPropertyValue("padding-bottom"))+parseFloat(r.getPropertyValue("padding-top")),i=parseFloat(r.getPropertyValue("border-bottom-width"))+parseFloat(r.getPropertyValue("border-top-width")),s=Me.map(function(o){return"".concat(o,":").concat(r.getPropertyValue(o))}).join(";"),y={sizingStyle:s,paddingSize:f,borderSize:i,boxSizing:l};return c&&a&&(ie[a]=y),y}function Be(e){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;h||(h=document.createElement("textarea"),h.setAttribute("tab-index","-1"),h.setAttribute("aria-hidden","true"),document.body.appendChild(h)),e.getAttribute("wrap")?h.setAttribute("wrap",e.getAttribute("wrap")):h.removeAttribute("wrap");var l=$e(e,c),f=l.paddingSize,i=l.borderSize,s=l.boxSizing,y=l.sizingStyle;h.setAttribute("style","".concat(y,";").concat(Fe)),h.value=e.value||e.placeholder||"";var o=void 0,u=void 0,z,g=h.scrollHeight;if(s==="border-box"?g+=i:s==="content-box"&&(g-=f),a!==null||r!==null){h.value=" ";var I=h.scrollHeight-f;a!==null&&(o=I*a,s==="border-box"&&(o=o+f+i),g=Math.max(o,g)),r!==null&&(u=I*r,s==="border-box"&&(u=u+f+i),z=g>u?"":"hidden",g=Math.min(u,g))}var m={height:g,overflowY:z,resize:"none"};return o&&(m.minHeight=o),u&&(m.maxHeight=u),m}var He=["prefixCls","onPressEnter","defaultValue","value","autoSize","onResize","className","style","disabled","onChange","onInternalAutoSize"],le=0,se=1,ue=2,Le=v.forwardRef(function(e,c){var a=e,r=a.prefixCls;a.onPressEnter;var l=a.defaultValue,f=a.value,i=a.autoSize,s=a.onResize,y=a.className,o=a.style,u=a.disabled,z=a.onChange;a.onInternalAutoSize;var g=pe(a,He),I=xe(l,{value:f,postState:function(d){return d??""}}),m=T(I,2),B=m[0],P=m[1],J=function(d){P(d.target.value),z==null||z(d)},p=v.useRef();v.useImperativeHandle(c,function(){return{textArea:p.current}});var F=v.useMemo(function(){return i&&he(i)==="object"?[i.minRows,i.maxRows]:[]},[i]),Y=T(F,2),C=Y[0],w=Y[1],V=!!i,H=function(){try{if(document.activeElement===p.current){var d=p.current,X=d.selectionStart,te=d.selectionEnd,ae=d.scrollTop;p.current.setSelectionRange(X,te),p.current.scrollTop=ae}}catch{}},Q=v.useState(ue),L=T(Q,2),S=L[0],N=L[1],E=v.useState(),W=T(E,2),Z=W[0],ee=W[1],M=function(){N(le)};ve(function(){V&&M()},[f,C,w,V]),ve(function(){if(S===le)N(se);else if(S===se){var x=Be(p.current,!1,C,w);N(ue),ee(x)}else H()},[S]);var k=v.useRef(),j=function(){ge.cancel(k.current)},G=function(d){S===ue&&(s==null||s(d),i&&(j(),k.current=ge(function(){M()})))};v.useEffect(function(){return j},[]);var O=V?Z:null,_=$($({},o),O);return(S===le||S===se)&&(_.overflowY="hidden",_.overflowX="hidden"),v.createElement(Pe,{onResize:G,disabled:!(i||s)},v.createElement("textarea",Se({},g,{ref:p,style:_,className:ce(r,y,de({},"".concat(r,"-disabled"),u)),disabled:u,value:B,onChange:J})))}),je=["defaultValue","value","onFocus","onBlur","onChange","allowClear","maxLength","onCompositionStart","onCompositionEnd","suffix","prefixCls","classes","showCount","className","style","disabled","hidden","classNames","styles","onResize"];function be(e,c){return q(e||"").slice(0,c).join("")}function me(e,c,a,r){var l=a;return e?l=be(a,r):q(c||"").length<a.length&&q(a||"").length>r&&(l=c),l}var Ge=R.forwardRef(function(e,c){var a,r=e.defaultValue,l=e.value,f=e.onFocus,i=e.onBlur,s=e.onChange,y=e.allowClear,o=e.maxLength,u=e.onCompositionStart,z=e.onCompositionEnd,g=e.suffix,I=e.prefixCls,m=I===void 0?"rc-textarea":I,B=e.classes,P=e.showCount,J=e.className,p=e.style,F=e.disabled,Y=e.hidden,C=e.classNames,w=e.styles,V=e.onResize,H=pe(e,je),Q=xe(r,{value:l,defaultValue:r}),L=T(Q,2),S=L[0],N=L[1],E=v.useRef(null),W=R.useState(!1),Z=T(W,2),ee=Z[0],M=Z[1],k=R.useState(!1),j=T(k,2),G=j[0],O=j[1],_=R.useRef(),x=R.useRef(0),d=R.useState(null),X=T(d,2),te=X[0],ae=X[1],ne=function(){var t;(t=E.current)===null||t===void 0||t.textArea.focus()};v.useImperativeHandle(c,function(){return{resizableTextArea:E.current,focus:ne,blur:function(){var t;(t=E.current)===null||t===void 0||t.textArea.blur()}}}),v.useEffect(function(){M(function(b){return!F&&b})},[F]);var U=Number(o)>0,Re=function(t){O(!0),_.current=S,x.current=t.currentTarget.selectionStart,u==null||u(t)},ze=function(t){O(!1);var n=t.currentTarget.value;if(U){var A,Ve=x.current>=o+1||x.current===((A=_.current)===null||A===void 0?void 0:A.length);n=me(Ve,_.current,n,o)}n!==S&&(N(n),oe(t.currentTarget,t,s,n)),z==null||z(t)},ye=function(t){var n=t.target.value;if(!G&&U){var A=t.target.selectionStart>=o+1||t.target.selectionStart===n.length||!t.target.selectionStart;n=me(A,S,n,o)}N(n),oe(t.currentTarget,t,s,n)},Ce=function(t){var n=H.onPressEnter,A=H.onKeyDown;t.key==="Enter"&&n&&n(t),A==null||A(t)},we=function(t){M(!0),f==null||f(t)},Ae=function(t){M(!1),i==null||i(t)},Ee=function(t){var n;N(""),ne(),oe((n=E.current)===null||n===void 0?void 0:n.textArea,t,s)},D=_e(S);!G&&U&&l==null&&(D=be(D,o));var re=g,K;if(P){var fe=q(D).length;he(P)==="object"?K=P.formatter({value:D,count:fe,maxLength:o}):K="".concat(fe).concat(U?" / ".concat(o):""),re=R.createElement(R.Fragment,null,re,R.createElement("span",{className:ce("".concat(m,"-data-count"),C==null?void 0:C.count),style:w==null?void 0:w.count},K))}var Te=function(t){var n;V==null||V(t),(n=E.current)!==null&&n!==void 0&&n.textArea.style.height&&ae(!0)},Ie=R.createElement(Ne,{value:D,allowClear:y,handleReset:Ee,suffix:re,prefixCls:m,classes:{affixWrapper:ce(B==null?void 0:B.affixWrapper,(a={},de(a,"".concat(m,"-show-count"),P),de(a,"".concat(m,"-textarea-allow-clear"),y),a))},disabled:F,focused:ee,className:J,style:$($({},p),te?{height:"auto"}:{}),dataAttrs:{affixWrapper:{"data-count":typeof K=="string"?K:void 0}},hidden:Y,inputElement:R.createElement(Le,Se({},H,{onKeyDown:Ce,onChange:ye,onFocus:we,onBlur:Ae,onCompositionStart:Re,onCompositionEnd:ze,className:C==null?void 0:C.textarea,style:$($({},w==null?void 0:w.textarea),{},{resize:p==null?void 0:p.resize}),disabled:F,prefixCls:m,onResize:Te,ref:E}))});return Ie});export{Ge as T};
